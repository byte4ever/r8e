---
version: "2"

linters:
  default: none
  enable:
    - asasalint
    - containedctx
    - copyloopvar
    - decorder
    - depguard
    - dogsled
    - dupl
    - durationcheck
    - errcheck
    - errname
    - errorlint
    - exhaustive
    - exptostd
    - fatcontext
    - forbidigo
    - forcetypeassert
    - funcorder
    - gochecknoglobals
    - gochecksumtype
    - gocritic
    - godot
    - godox
    - gomoddirectives
    - gomodguard
    - goprintffuncname
    - gosec
    - gosmopolitan
    - govet
    - iface
    - importas
    - inamedparam
    - ineffassign
    - interfacebloat
    - intrange
    - ireturn
    - lll
    - loggercheck
    - maintidx
    - makezero
    - mirror
    - musttag
    - nilnesserr
    - nilnil
    - noctx
    - nolintlint
    - nosprintfhostport
    - paralleltest
    - perfsprint
    - prealloc
    - predeclared
    - promlinter
    - protogetter
    - reassign
    - recvcheck
    - revive
    - rowserrcheck
    - sloglint
    - spancheck
    - sqlclosecheck
    - staticcheck
    - tagalign
    - tagliatelle
    - testableexamples
    - testifylint
    - testpackage
    - thelper
    - tparallel
    - unconvert
    - unparam
    - unused
    - usestdlibvars
    - usetesting
    - varnamelen
    - wastedassign
    - wrapcheck
    - wsl_v5

  settings:
    asasalint:
      exclude:
        - Append
        - \.Wrapf
      use-builtin-exclusions: false

    copyloopvar:
      check-alias: true

    decorder:
      dec-order:
        - type
        - const
        - var
        - func
      ignore-underscore-vars: false
      disable-dec-order-check: false
      disable-init-func-first-check: false
      disable-dec-num-check: false
      disable-type-dec-num-check: false
      disable-const-dec-num-check: false
      disable-var-dec-num-check: false

    depguard:
      rules:
        main:
          list-mode: lax
          allow:
            - $gostd
          deny:
            - pkg: "math/rand$"
              desc: use math/rand/v2
            - pkg: "github.com/sirupsen/logrus"
              desc: not allowed
            - pkg: "github.com/pkg/errors"
              desc: Should be replaced by standard lib errors package

    dogsled:
      max-blank-identifiers: 3

    dupl:
      threshold: 100

    errcheck:
      check-type-assertions: true
      check-blank: true
      disable-default-exclusions: true
      exclude-functions:
        - io/ioutil.ReadFile
        - io.Copy(*bytes.Buffer)
        - io.Copy(os.Stdout)

    exhaustive:
      check:
        - switch
        - map
      default-signifies-exhaustive: true
      ignore-enum-members: "Example.+"
      ignore-enum-types: "Example.+"
      package-scope-only: true
      explicit-exhaustive-switch: true
      explicit-exhaustive-map: true
      default-case-required: true

    fatcontext:
      check-struct-pointers: true

    forbidigo:
      forbid:
        - pattern: ^print(ln)?$
        - pattern: ^fmt\.Print.*$
          msg: Do not commit print statements.
        - pattern: 'fmt\.Print.*(# Do not commit print statements\.)?'
        - pattern: ^spew\.(ConfigState\.)?Dump$
        - pattern: ^v1.Dump$
          pkg: ^example.com/pkg/api/v1$
      exclude-godoc-examples: false
      analyze-types: true

    funcorder:
      constructor: false
      struct-method: false

    gochecksumtype:
      default-signifies-exhaustive: false
      include-shared-interfaces: true

    gocritic:
      disable-all: true
      enabled-checks:
        - appendAssign
        - appendCombine
        - argOrder
        - assignOp
        - badCall
        - badCond
        - badLock
        - badRegexp
        - badSorting
        - badSyncOnceFunc
        - boolExprSimplify
        - builtinShadow
        - builtinShadowDecl
        - captLocal
        - caseOrder
        - codegenComment
        - commentFormatting
        - commentedOutCode
        - commentedOutImport
        - defaultCaseOrder
        - deferInLoop
        - deferUnlambda
        - deprecatedComment
        - docStub
        - dupArg
        - dupBranchBody
        - dupCase
        - dupImport
        - dupSubExpr
        - dynamicFmtString
        - elseif
        - emptyDecl
        - emptyFallthrough
        - emptyStringTest
        - equalFold
        - evalOrder
        - exitAfterDefer
        - exposedSyncMutex
        - externalErrorReassign
        - filepathJoin
        - flagDeref
        - flagName
        - hexLiteral
        - httpNoBody
        - hugeParam
        - ifElseChain
        - importShadow
        - indexAlloc
        - initClause
        - mapKey
        - methodExprCall
        - nestingReduce
        - newDeref
        - nilValReturn
        - octalLiteral
        - offBy1
        - paramTypeCombine
        - preferDecodeRune
        - preferFilepathJoin
        - preferFprint
        - preferStringWriter
        - preferWriteByte
        - ptrToRefParam
        - rangeAppendAll
        - rangeExprCopy
        - rangeValCopy
        - redundantSprint
        - regexpMust
        - regexpPattern
        - regexpSimplify
        - returnAfterHttpError
        - ruleguard
        - singleCaseSwitch
        - sliceClear
        - sloppyLen
        - sloppyReassign
        - sloppyTypeAssert
        - sortSlice
        - sprintfQuotedString
        - sqlQuery
        - stringConcatSimplify
        - stringXbytes
        - stringsCompare
        - switchTrue
        - syncMapLoadAndDelete
        - timeExprSimplify
        - todoCommentWithoutDetail
        - tooManyResultsChecker
        - truncateCmp
        - typeAssertChain
        - typeDefFirst
        - typeSwitchVar
        - typeUnparen
        - uncheckedInlineErr
        - underef
        - unlabelStmt
        - unlambda
        - unnamedResult
        - unnecessaryBlock
        - unnecessaryDefer
        - unslice
        - valSwap
        - weakCond
        - whyNoLint
        - wrapperFunc
        - yodaStyleExpr

    godot:
      scope: toplevel

    godox:
      keywords:
        - NOTE
        - OPTIMIZE
        - HACK

    gomoddirectives:
      replace-local: true
      replace-allow-list:
        - launchpad.net/gocheck
      retract-allow-no-explanation: true
      exclude-forbidden: true
      toolchain-forbidden: true
      toolchain-pattern: 'go1\.23\.\d+$'
      tool-forbidden: true
      go-debug-forbidden: true
      go-version-pattern: '\d\.\d+(\.0)?'

    gomodguard:
      blocked:
        modules:
          - github.com/uudashr/go-module:
              recommendations:
                - golang.org/x/mod
              reason: "`mod` is the official go.mod parser library."
        versions:
          - github.com/mitchellh/go-homedir:
              version: "< 1.1.0"
              reason: "testing if blocked version constraint works."
        local-replace-directives: false

    gosec:
      excludes:
        - G404
      severity: medium
      confidence: medium
      concurrency: 12

    gosmopolitan:
      allow-time-local: true
      escape-hatches:
        - 'github.com/nicksnyder/go-i18n/v2/i18n.Message'
      watch-for-scripts:
        - Devanagari
        - Han
        - Hangul
        - Hiragana
        - Katakana

    govet:
      disable-all: true
      enable:
        - appends
        - asmdecl
        - assign
        - atomic
        - atomicalign
        - bools
        - buildtag
        - cgocall
        - composites
        - copylocks
        - deepequalerrors
        - defers
        - directive
        - errorsas
        - fieldalignment
        - findcall
        - framepointer
        - httpmux
        - httpresponse
        - ifaceassert
        - loopclosure
        - lostcancel
        - nilfunc
        - nilness
        - printf
        - reflectvaluecompare
        - shadow
        - shift
        - sigchanyzer
        - slog
        - sortslice
        - stdmethods
        - stdversion
        - stringintconv
        - structtag
        - testinggoroutine
        - tests
        - timeformat
        - unmarshal
        - unreachable
        - unsafeptr
        - unusedresult
        - unusedwrite
        - waitgroup
      settings:
        shadow:
          strict: true

    iface:
      enable:
        - identical
        - unused
        - opaque

    inamedparam:
      skip-single-param: true

    interfacebloat:
      max: 5

    ireturn:
      allow:
        - anon
        - error
        - empty
        - stdlib
        - (or|er)$

    lll:
      line-length: 120
      tab-width: 1

    loggercheck:
      kitlog: false
      klog: false
      logr: false
      slog: false
      zap: false
      require-string-key: true
      no-printf-like: true

    maintidx:
      under: 20

    makezero:
      always: true

    nilnil:
      only-two: false
      detect-opposite: true
      checked-types:
        - chan
        - func
        - iface
        - map
        - ptr
        - uintptr
        - unsafeptr

    nolintlint:
      allow-unused: true
      allow-no-explanation: []
      require-explanation: true
      require-specific: true

    paralleltest:
      ignore-missing: true
      ignore-missing-subtests: true

    perfsprint:
      integer-format: true
      int-conversion: true
      error-format: true
      err-error: false
      errorf: true
      string-format: true
      sprintf1: true
      strconcat: true
      bool-format: true
      hex-format: true

    prealloc:
      simple: true
      range-loops: true
      for-loops: true

    predeclared:
      ignore:
        - new
        - int
      qualified-name: true

    promlinter:
      strict: true
      disabled-linters:
        - Help
        - MetricUnits
        - Counter
        - HistogramSummaryReserved
        - MetricTypeInName
        - ReservedChars
        - CamelCase
        - UnitAbbreviations

    protogetter:
      skip-any-generated: true
      replace-first-arg-in-append: true

    reassign:
      patterns:
        - ".*"

    recvcheck:
      disable-builtin: true
      exclusions:
        - "*.Value"

    revive:
      enable-all-rules: true
      directives:
        - name: specify-disable-reason
          severity: error
      confidence: 0.1
      rules:
        - name: add-constant
          severity: warning
          disabled: true
        - name: argument-limit
          severity: warning
          disabled: false
          arguments: [4]
        - name: atomic
          severity: warning
          disabled: false
        - name: banned-characters
          severity: warning
          disabled: false
          arguments: ["Ω", "Σ", "σ", "7"]
        - name: bare-return
          severity: warning
          disabled: true
        - name: blank-imports
          severity: warning
          disabled: false
        - name: bool-literal-in-expr
          severity: warning
          disabled: false
        - name: call-to-gc
          severity: warning
          disabled: false
        - name: cognitive-complexity
          severity: warning
          disabled: true
          arguments: [7]
        - name: comment-spacings
          severity: warning
          disabled: true
        - name: confusing-naming
          severity: warning
          disabled: false
        - name: confusing-results
          severity: warning
          disabled: false
        - name: constant-logical-expr
          severity: warning
          disabled: false
        - name: context-as-argument
          severity: warning
          disabled: false
        - name: context-keys-type
          severity: warning
          disabled: false
        - name: cyclomatic
          severity: warning
          disabled: true
          arguments: [3]
        - name: datarace
          severity: warning
          disabled: false
        - name: deep-exit
          severity: warning
          disabled: false
        - name: defer
          severity: warning
          disabled: false
          arguments:
            - ["call-chain", "loop", "method-call", "recover", "immediate-recover", "return"]
        - name: dot-imports
          severity: warning
          disabled: false
        - name: duplicated-imports
          severity: warning
          disabled: false
        - name: early-return
          severity: warning
          disabled: false
          arguments:
            - "preserve-scope"
            - "allow-jump"
        - name: empty-block
          severity: warning
          disabled: false
        - name: empty-lines
          severity: warning
          disabled: true
        - name: enforce-map-style
          severity: warning
          disabled: false
          arguments:
            - "make"
        - name: enforce-repeated-arg-type-style
          severity: warning
          disabled: false
          arguments:
            - "short"
            - func-arg-style: "full"
              func-ret-val-style: "short"
        - name: enforce-slice-style
          severity: warning
          disabled: false
          arguments:
            - "nil"
        - name: error-naming
          severity: warning
          disabled: false
        - name: error-return
          severity: warning
          disabled: false
        - name: error-strings
          severity: warning
          disabled: false
        - name: errorf
          severity: warning
          disabled: false
        - name: exported
          severity: warning
          disabled: false
          arguments:
            - "check-private-receivers"
            - "disable-stuttering-check"
            - "say-repetitive-instead-of-stutters"
            - "check-public-interface"
        - name: file-header
          severity: warning
          disabled: true
        - name: file-length-limit
          severity: warning
          disabled: true
        - name: filename-format
          severity: warning
          disabled: false
          arguments:
            - "^[_a-z][_a-z0-9]*\\.go$"
        - name: flag-parameter
          severity: warning
          disabled: false
        - name: function-length
          severity: warning
          disabled: true
          arguments: [10, 0]
        - name: function-result-limit
          severity: warning
          disabled: false
          arguments: [3]
        - name: get-return
          severity: warning
          disabled: false
        - name: identical-branches
          severity: warning
          disabled: false
        - name: if-return
          severity: warning
          disabled: false
        - name: import-alias-naming
          severity: warning
          disabled: false
          arguments:
            - "^[a-z][a-z0-9]{0,}$"
        - name: import-shadowing
          severity: warning
          disabled: false
        - name: imports-blocklist
          severity: warning
          disabled: false
          arguments:
            - "crypto/md5"
            - "crypto/sha1"
        - name: increment-decrement
          severity: warning
          disabled: false
        - name: indent-error-flow
          severity: warning
          disabled: false
          arguments:
            - "preserve-scope"
        - name: line-length-limit
          severity: warning
          disabled: true
          arguments: [80]
        - name: max-control-nesting
          severity: warning
          disabled: false
          arguments: [5]
        - name: max-public-structs
          severity: warning
          disabled: true
          arguments: [3]
        - name: modifies-parameter
          severity: warning
          disabled: false
        - name: modifies-value-receiver
          severity: warning
          disabled: false
        - name: nested-structs
          severity: warning
          disabled: false
        - name: optimize-operands-order
          severity: warning
          disabled: false
        - name: package-comments
          severity: warning
          disabled: true
        - name: range
          severity: warning
          disabled: false
        - name: range-val-address
          severity: warning
          disabled: false
        - name: range-val-in-closure
          severity: warning
          disabled: false
        - name: receiver-naming
          severity: warning
          disabled: false
          arguments:
            - max-length: 2
        - name: redefines-builtin-id
          severity: warning
          disabled: false
        - name: redundant-build-tag
          severity: warning
          disabled: false
        - name: redundant-import-alias
          severity: warning
          disabled: false
        - name: redundant-test-main-exit
          severity: warning
          disabled: false
        - name: string-format
          severity: warning
          disabled: false
          arguments:
            - - 'core.WriteError[1].Message'
              - '/^([^A-Z]|$)/'
              - must not start with a capital letter
            - - 'fmt.Errorf[0]'
              - '/(^|[^\.!?])$/'
              - must not end in punctuation
            - - panic
              - '/^[^\n]*$/'
              - must not contain line breaks
        - name: string-of-int
          severity: warning
          disabled: false
        - name: struct-tag
          severity: warning
          disabled: false
          arguments:
            - "json,inline"
            - "bson,outline,gnu"
        - name: superfluous-else
          severity: warning
          disabled: false
          arguments:
            - "preserve-scope"
        - name: time-equal
          severity: warning
          disabled: false
        - name: time-naming
          severity: warning
          disabled: false
        - name: unchecked-type-assertion
          severity: warning
          disabled: false
          arguments:
            - accept-ignored-assertion-result: true
        - name: unconditional-recursion
          severity: warning
          disabled: false
        - name: unexported-naming
          severity: warning
          disabled: false
        - name: unexported-return
          severity: warning
          disabled: false
        - name: unhandled-error
          severity: warning
          disabled: true
          arguments:
            - "fmt.Printf"
            - "myFunction"
        - name: unnecessary-stmt
          severity: warning
          disabled: false
        - name: unreachable-code
          severity: warning
          disabled: false
        - name: unused-parameter
          severity: warning
          disabled: false
          arguments:
            - allow-regex: "^_"
        - name: unused-receiver
          severity: warning
          disabled: false
          arguments:
            - allow-regex: "^_"
        - name: use-any
          severity: warning
          disabled: false
        - name: use-errors-new
          severity: warning
          disabled: false
        - name: useless-break
          severity: warning
          disabled: false
        - name: var-declaration
          severity: warning
          disabled: false
        - name: var-naming
          severity: warning
          disabled: false
          arguments:
            - ["ID"]
            - ["VM"]
            - - upper-case-const: true
        - name: waitgroup-by-value
          severity: warning
          disabled: false

    rowserrcheck:
      packages:
        - github.com/jmoiron/sqlx

    spancheck:
      checks:
        - end
        - record-error
        - set-status

    staticcheck:
      checks:
        - all

    tagalign:
      align: false
      sort: false
      order:
        - json
        - yaml
        - yml
        - toml
        - mapstructure
        - binding
        - validate
      strict: true

    tagliatelle:
      case:
        rules:
          json: snake
          yaml: snake
          xml: camel
          toml: camel
          bson: camel
          avro: snake
          mapstructure: kebab
          env: upperSnake
          envconfig: upperSnake
        use-field-name: true

    testifylint:
      disable-all: true
      enable:
        - blank-import
        - bool-compare
        - compares
        - contains
        - empty
        - encoded-compare
        - equal-values
        - error-is-as
        - error-nil
        - expected-actual
        - float-compare
        - formatter
        - go-require
        - len
        - negative-positive
        - nil-compare
        - regexp
        - require-error
        - suite-broken-parallel
        - suite-dont-use-pkg
        - suite-extra-assert-call
        - suite-method-signature
        - suite-subtest-run
        - suite-thelper
        - useless-assert

    testpackage:
      skip-regexp: (export|internal)_test\.go
      allow-packages:
        - example
        - main

    thelper:
      test:
        first: true
        name: true
        begin: true
      benchmark:
        first: true
        name: true
        begin: true
      tb:
        first: true
        name: true
        begin: true
      fuzz:
        first: true
        name: true
        begin: true

    unconvert:
      fast-math: true
      safe: true

    unparam:
      check-exported: true

    usestdlibvars:
      http-method: false
      http-status-code: false
      time-weekday: true
      time-month: true
      time-layout: true
      crypto-hash: true
      default-rpc-path: true
      sql-isolation-level: true
      tls-signature-scheme: true
      constant-kind: true

    usetesting:
      os-temp-dir: true

    varnamelen:
      max-distance: 6
      min-name-length: 2
      check-return: true
      check-type-param: true
      ignore-type-assert-ok: true
      ignore-map-index-ok: true
      ignore-chan-recv-ok: true
      ignore-names:
        - err
      ignore-decls:
        - c echo.Context
        - t testing.T
        - f *foo.Bar
        - e error
        - i int
        - const C
        - T any
        - m map[string]int

    wrapcheck:
      ignore-sigs:
        - .Errorf(
        - errors.New(
        - errors.Unwrap(
        - errors.Join(
        - .Wrap(
        - .Wrapf(
        - .WithMessage(
        - .WithMessagef(
        - .WithStack(
      ignore-sig-regexps:
        - \.New.*Error\(
      ignore-package-globs:
        - encoding/*
        - github.com/pkg/*
      ignore-interface-regexps:
        - ^(?i)c(?-i)ach(ing|e)

    wsl_v5:
      allow-first-in-block: true
      allow-whole-block: false
      branch-max-lines: 2
      enable:
        - err

  exclusions:
    generated: lax
    warn-unused: true
    presets:
      - comments
      - std-error-handling
      - common-false-positives
      - legacy
    rules:
      - path: _test\.go
        linters:
          - gocyclo
          - errcheck
          - dupl
          - gosec
      - linters:
          - staticcheck
        text: "SA9003:"
      - linters:
          - lll
        source: "^//go:generate "

formatters:
  enable: []

output:
  path-prefix: ""
  sort-order:
    - linter
    - severity
    - file
  show-stats: false

run:
  timeout: 5m
  relative-path-mode: gomod
  issues-exit-code: 2
  tests: false
  modules-download-mode: readonly
  allow-parallel-runners: true
  allow-serial-runners: true
  go: '1.25'
  concurrency: 4

severity:
  default: error
  rules:
    - linters:
        - dupl
      severity: info
